export async function fetchCSV(url:string){const r=await fetch(url,{cache:'no-cache'});if(!r.ok)throw new Error('CSV');const t=await r.text();return parseCSV(t)}
export function parseCSV(t:string){const rows:string[][]=[];let cur='',row:string[]=[],q=false;for(let i=0;i<t.length;i++){const c=t[i];if(c==='"'){if(q&&t[i+1]==='"'){cur+='"';i++}else{q=!q}}else if(c===','&&!q){row.push(cur);cur=''}else if((c==='\n'||c==='\r')&&!q){if(cur||row.length){row.push(cur);rows.push(row);row=[];cur=''}}else{cur+=c}}if(cur||row.length){row.push(cur);rows.push(row)}const h=rows.shift()||[];return rows.map(r=>Object.fromEntries(h.map((k,i)=>[k.trim(),(r[i]||'').trim()]))) }